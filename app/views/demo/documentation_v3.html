<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maintenance Checklist System Documentation</title>
    <style>
        :root {
            --primary: #0056b3;
            --secondary: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
            --border: #dee2e6;
            --code-bg: #f1f1f1;
            --success: #d4edda;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #fafafa;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), #003d7a);
            color: white;
            padding: 2rem 1rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
            overflow: hidden;
        }
        
        .card-header {
            background-color: var(--primary);
            color: white;
            padding: 1.25rem 1.5rem;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        .section {
            margin-bottom: 2.5rem;
        }
        
        h2 {
            color: var(--primary);
            margin: 1.5rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary);
        }
        
        h3 {
            color: var(--dark);
            margin: 1.25rem 0 0.75rem;
            font-size: 1.25rem;
        }
        
        p {
            margin-bottom: 1rem;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }
        
        .feature-card {
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 1.25rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .feature-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .feature-card h4 {
            color: var(--primary);
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }
        
        .code-block {
            background-color: var(--code-bg);
            border-left: 4px solid var(--primary);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
            overflow-x: auto;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 0.95rem;
        }
        
        .code-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        .param-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        .param-table th {
            background-color: var(--primary);
            color: white;
            text-align: left;
            padding: 0.75rem;
        }
        
        .param-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border);
        }
        
        .param-table tr:nth-child(even) {
            background-color: rgba(0, 86, 179, 0.03);
        }
        
        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-right: 0.5rem;
        }
        
        .badge-required {
            background-color: var(--danger);
            color: white;
        }
        
        .badge-optional {
            background-color: var(--warning);
            color: var(--dark);
        }
        
        .usage-example {
            background-color: var(--success);
            border-left: 4px solid var(--secondary);
            padding: 1rem;
            margin: 1.5rem 0;
            border-radius: 4px;
        }
        
        .flow-diagram {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 2rem 0;
        }
        
        .flow-step {
            display: flex;
            align-items: center;
            margin: 1rem 0;
            width: 100%;
            max-width: 600px;
        }
        
        .flow-number {
            background-color: var(--primary);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 1rem;
            flex-shrink: 0;
        }
        
        footer {
            text-align: center;
            padding: 2rem 1rem;
            color: var(--gray);
            border-top: 1px solid var(--border);
            margin-top: 2rem;
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Maintenance Checklist System</h1>
        <p>Technical Documentation for Model and Controller Classes</p>
    </header>
    
    <div class="container">
        <div class="card">
            <div class="card-header">
                Overview
            </div>
            <div class="card-body">
                <p>This documentation provides detailed information about the <strong>Maintenance Checklist System</strong> architecture, focusing on the model and controller classes. The system is designed for secure, tenant-isolated maintenance operations with atomic database transactions.</p>
                
                <div class="grid">
                    <div class="feature-card">
                        <h4>üîê Tenant Security</h4>
                        <p>All operations are scoped to the current tenant using <code>tenant_id</code> (GUID) to prevent cross-tenant data access.</p>
                    </div>
                    <div class="feature-card">
                        <h4>üîÑ Atomic Transactions</h4>
                        <p>Checklist header and task updates happen in a single database transaction to ensure data consistency.</p>
                    </div>
                    <div class="feature-card">
                        <h4>‚úÖ Type Safety</h4>
                        <p>Strict validation of GUIDs and integers prevents SQL conversion errors and injection attacks.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                Model Class: MaintenanceChecklistUpdateModel
            </div>
            <div class="card-body">
                <p>The model handles all database operations with built-in security and transaction management. All methods include tenant scoping to prevent unauthorized access.</p>
                
                <div class="section">
                    <h2>1. checklistBelongsToTenant()</h2>
                    <p>Verifies that a maintenance checklist belongs to the specified tenant.</p>
                    
                    <h3>Parameters</h3>
                    <table class="param-table">
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>$maintenanceChecklistId</code></td>
                                <td><code>int</code></td>
                                <td>The ID of the maintenance checklist</td>
                            </tr>
                            <tr>
                                <td><code>$tenantId</code></td>
                                <td><code>string</code></td>
                                <td>Tenant GUID (e.g., '9C4FFC4D-CF21-466D-A256-34A38C0CCD...')</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="usage-example">
                        <strong>Usage Example:</strong>
                        <div class="code-block">if (!$model->checklistBelongsToTenant(123, '9C4F...')) {
    throw new Exception("Access denied");
}</div>
                    </div>
                </div>
                
                <div class="section">
                    <h2>2. updateChecklist()</h2>
                    <p>Updates the master checklist header fields with tenant scoping.</p>
                    
                    <h3>Required Data Keys</h3>
                    <table class="param-table">
                        <thead>
                            <tr>
                                <th>Key</th>
                                <th>Type</th>
                                <th>Required</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>maintenance_checklist_id</code></td>
                                <td><code>int</code></td>
                                <td><span class="badge badge-required">Required</span></td>
                                <td>Checklist ID</td>
                            </tr>
                            <tr>
                                <td><code>tenant_id</code></td>
                                <td><code>string</code></td>
                                <td><span class="badge badge-required">Required</span></td>
                                <td>Tenant GUID</td>
                            </tr>
                            <tr>
                                <td><code>technician</code></td>
                                <td><code>string|null</code></td>
                                <td><span class="badge badge-optional">Optional</span></td>
                                <td>Technician name</td>
                            </tr>
                            <tr>
                                <td><code>status</code></td>
                                <td><code>string|null</code></td>
                                <td><span class="badge badge-optional">Optional</span></td>
                                <td>Checklist status</td>
                            </tr>
                            <tr>
                                <td><code>date_started</code></td>
                                <td><code>string|null</code></td>
                                <td><span class="badge badge-optional">Optional</span></td>
                                <td>Start date in 'Y-m-d H:i:s' format</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="usage-example">
                        <strong>Special Behavior:</strong>
                        <p>When <code>status</code> is set to 'Completed', <code>date_completed</code> is automatically set to current time if not already set.</p>
                    </div>
                </div>
                
                <div class="section">
                    <h2>3. updateTasksBatch()</h2>
                    <p>Updates multiple checklist tasks in a single operation.</p>
                    
                    <h3>Task Data Structure</h3>
                    <table class="param-table">
                        <thead>
                            <tr>
                                <th>Key</th>
                                <th>Type</th>
                                <th>Required</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>task_id</code></td>
                                <td><code>int</code></td>
                                <td><span class="badge badge-required">Required</span></td>
                                <td>Task ID</td>
                            </tr>
                            <tr>
                                <td><code>result_value</code></td>
                                <td><code>string|null</code></td>
                                <td><span class="badge badge-optional">Optional</span></td>
                                <td>Task result ('Pending', 'OK', 'Not OK')</td>
                            </tr>
                            <tr>
                                <td><code>result_notes</code></td>
                                <td><code>string|null</code></td>
                                <td><span class="badge badge-optional">Optional</span></td>
                                <td>Technician remarks</td>
                            </tr>
                            <tr>
                                <td><code>completed_flag</code></td>
                                <td><code>bool</code></td>
                                <td><span class="badge badge-optional">Optional</span></td>
                                <td>If true, sets <code>completed_at</code> to current time</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="usage-example">
                        <strong>Usage Example:</strong>
                        <div class="code-block">$tasks = [
    ['task_id' => 456, 'result_value' => 'OK', 'completed_flag' => true],
    ['task_id' => 457, 'result_value' => 'Not OK', 'result_notes' => 'Needs repair']
];
$updatedCount = $model->updateTasksBatch($tasks);</div>
                    </div>
                </div>
                
                <div class="section">
                    <h2>4. markChecklistComplete()</h2>
                    <p>Quickly marks a checklist as completed with proper tenant scoping.</p>
                    
                    <div class="usage-example">
                        <strong>Usage Example:</strong>
                        <div class="code-block">$model->markChecklistComplete(123, '9C4F...');</div>
                    </div>
                </div>
                
                <div class="section">
                    <h2>5. updateChecklistWithTasks()</h2>
                    <p>‚ú® <strong>Recommended method</strong> for user-initiated updates. Atomically updates both checklist header and tasks in a single transaction.</p>
                    
                    <h3>Payload Structure</h3>
                    <div class="code-block">[
    'maintenance_checklist_id' => 123,
    'tenant_id' => '9C4F...',
    'header' => [ /* updateChecklist() data */ ],
    'tasks' => [ /* updateTasksBatch() data */ ]
]</div>
                    
                    <div class="usage-example">
                        <strong>Returns:</strong>
                        <div class="code-block">['updated_tasks' => 5, 'header_updated' => true]</div>
                    </div>
                </div>
                
                <div class="section">
                    <h2>6. fetchChecklistWithTasks()</h2>
                    <p>Retrieves a complete checklist (header + tasks) for display purposes.</p>
                    
                    <div class="usage-example">
                        <strong>Returns:</strong>
                        <div class="code-block">[
    'master' => [ /* checklist row */ ],
    'tasks' => [ /* array of task rows */ ]
]</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                Controller Class: MaintenanceChecklistUpdateController
            </div>
            <div class="card-body">
                <p>The controller handles HTTP requests, validates input, and orchestrates model operations. It ensures secure, user-friendly interactions with the maintenance checklist system.</p>
                
                <div class="section">
                    <h2>update() Method</h2>
                    <p>Handles POST requests to update maintenance checklists from user forms.</p>
                    
                    <h3>Request Flow</h3>
                    <div class="flow-diagram">
                        <div class="flow-step">
                            <div class="flow-number">1</div>
                            <div>Validates user session (<code>$_SESSION['tenant_id']</code>)</div>
                        </div>
                        <div class="flow-step">
                            <div class="flow-number">2</div>
                            <div>Validates <code>maintenance_checklist_id</code> is a valid integer</div>
                        </div>
                        <div class="flow-step">
                            <div class="flow-number">3</div>
                            <div>Checks tenant ownership via <code>checklistBelongsToTenant()</code></div>
                        </div>
                        <div class="flow-step">
                            <div class="flow-number">4</div>
                            <div>Builds payload for <code>updateChecklistWithTasks()</code></div>
                        </div>
                        <div class="flow-step">
                            <div class="flow-number">5</div>
                            <div>Executes atomic update</div>
                        </div>
                        <div class="flow-step">
                            <div class="flow-number">6</div>
                            <div>Redirects with success/error message</div>
                        </div>
                    </div>
                    
                    <h3>Expected Form Structure</h3>
                    <div class="code-block"><input name="maintenance_checklist_id" value="123">
<select name="tasks[0][status]">...</select>
<input name="tasks[0][remarks]">
<input name="tasks[0][task_id]" value="456">
<button name="action" value="save">Save</button>
<button name="action" value="complete">Complete</button></div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                Usage Guidelines
            </div>
            <div class="card-body">
                <h2>When to Use Which Model Method?</h2>
                
                <div class="grid">
                    <div class="feature-card">
                        <h4>üìù User Form Submission</h4>
                        <p>Use <code>updateChecklistWithTasks()</code> for complete atomic updates from user interfaces.</p>
                    </div>
                    <div class="feature-card">
                        <h4>‚ö° Quick Completion</h4>
                        <p>Use <code>markChecklistComplete()</code> for simple completion without task updates.</p>
                    </div>
                    <div class="feature-card">
                        <h4>üõ†Ô∏è Background Processing</h4>
                        <p>Use <code>updateTasksBatch()</code> when only task results need updating.</p>
                    </div>
                    <div class="feature-card">
                        <h4>‚úèÔ∏è Header-Only Edits</h4>
                        <p>Use <code>updateChecklist()</code> when only checklist metadata needs updating.</p>
                    </div>
                </div>
                
                <h2>Security Best Practices</h2>
                <ul style="padding-left: 1.5rem; margin-top: 1rem;">
                    <li><strong>Always validate tenant ownership</strong> before any update operation</li>
                    <li><strong>Use transactions</strong> for operations affecting multiple records</li>
                    <li><strong>Validate all input types</strong> (GUIDs, integers) before database operations</li>
                    <li><strong>Never expose raw exceptions</strong> to end users</li>
                </ul>
            </div>
        </div>
    </div>
    
    <footer>
        <p>Maintenance Checklist System Documentation | Generated on November 26, 2025</p>
        <p>For technical support, contact the development team</p>
    </footer>
</body>
</html>