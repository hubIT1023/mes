<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Maintenance Management System (MMS) — Documentation</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 2rem; background: #f8fafc; color: #0f172a; }
    .page { background: #fff; border-radius: 8px; box-shadow: 0 6px 18px rgba(15,23,42,0.06); padding: 2rem; }
    pre { background:#0b1220; color:#e6eef8; padding:1rem; border-radius:6px; overflow:auto; }
    code { background:#eef2ff; padding: .1rem .3rem; border-radius:4px; }
    .badge-feature { background:#eef2ff; color:#075985; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; }
    .section-title { border-left:4px solid #0ea5a4; padding-left: .75rem; }
    nav .nav-link { color: #0f172a; }
    .flow { font-family: ui-monospace, monospace; white-space: pre; background:#f1f5f9; padding:1rem; border-radius:6px; }
  </style>
</head>
<body>
  <div class="container page">
    <header class="d-flex align-items-start justify-content-between mb-4">
      <div>
        <h1 class="h3">Maintenance Management System (MMS)</h1>
        <p class="text-muted mb-0">Documentation — introduction, architecture, folder layout, and usage notes. Ready for web deployment.</p>
      </div>
      <div class="text-end">
        <small class="text-muted">Generated: <?= date('Y-m-d') ?></small>
      </div>
    </header>

    <nav class="mb-4">
      <div class="row g-2">
        <div class="col-auto">
          <a href="#abstract" class="btn btn-outline-primary btn-sm">Abstract</a>
        </div>
        <div class="col-auto">
          <a href="#features" class="btn btn-outline-primary btn-sm">Key Features</a>
        </div>
        <div class="col-auto">
          <a href="#folders" class="btn btn-outline-primary btn-sm">Folder Structure</a>
        </div>
        <div class="col-auto">
          <a href="#architecture" class="btn btn-outline-primary btn-sm">Architecture</a>
        </div>
        <div class="col-auto">
          <a href="#process" class="btn btn-outline-primary btn-sm">Process Flows</a>
        </div>
        <div class="col-auto">
          <a href="#readme" class="btn btn-outline-primary btn-sm">README</a>
        </div>
      </div>
    </nav>

    <section id="abstract" class="mb-4">
      <h2 class="section-title">Abstract / Introduction</h2>
      <p>
        The <strong>Maintenance Management System (MMS)</strong> is a multi-tenant web application built to help organizations
        manage assets, schedule preventive maintenance, generate routine work orders automatically from checklist templates,
        and track maintenance activities — including spare parts usage and inventory.
      </p>
      <p class="text-muted small mb-0">
        Built with an MVC pattern, MSSQL backend and a lightweight PHP frontend, MMS is intended for industrial and facilities
        operations teams who need predictable, auditable maintenance workflows.
      </p>
    </section>

    <section id="features" class="mb-4">
      <h2 class="section-title">Key Features</h2>

      <h5 class="mt-3">Core Features</h5>
      <ul>
        <li><strong>Asset Management</strong> — register assets with multi-level locations and metadata.</li>
        <li><strong>Checklist Templates</strong> — create, edit and version maintenance checklists.</li>
        <li><strong>Routine Work Order Generator</strong> — create scheduled work orders for selected assets from templates.</li>
        <li><strong>Work Order Management</strong> — status tracking (scheduled, pending, in-progress, completed).</li>
        <li><strong>Technician Assignment</strong> — default or manual assignment.</li>
        <li><strong>Multi-tenant security</strong> — tenant/organization isolation via `org_id` / `tenant_id`.</li>
        <li><strong>Dashboard</strong> — upcoming maintenance, overdue items and quick filters.</li>
      </ul>

      <h5 class="mt-3">Spare Parts Management</h5>
      <p><span class="badge badge-feature">Included</span> The MMS includes a spare parts inventory module with:</p>
      <ul>
        <li>Parts master records and stock levels</li>
        <li>Parts consumption logging per work order</li>
        <li>Low-stock alerts and reorder notifications</li>
        <li>Supplier records and PO support</li>
      </ul>
    </section>

    <section id="folders" class="mb-4">
      <h2 class="section-title">File & Folder Structure (project root)</h2>
      <p class="mb-2">Paste this under <code>f:\xamp_server\htdocs\mes\</code> — descriptions included.</p>

      <pre class="mono">
f:\xamp_server\htdocs\mes\
│
├── index.php                    -- Front controller (single entry)
├── .htaccess                    -- Apache rewrite (clean URLs)
├── .env                         -- Environment / DB credentials
└── app\
    ├── routes.php               -- Route definitions -> controllers
    ├── config\
    │   ├── EnvLoader.php        -- Loads .env values
    │   └── Database.php         -- PDO connection to MSSQL
    ├── controllers\             -- HTTP controllers (MVC)
    │   ├── PagesController.php
    │   ├── SigninController.php
    │   ├── ChecklistTemplateController.php
    │   └── RoutineMaintenanceController.php
    ├── models\                  -- Data access & business logic
    │   ├── ChecklistModel.php
    │   ├── RoutineMaintenanceModel.php
    │   └── RoutineWorkOrderModel.php
    └── views\                   -- HTML views (Bootstrap)
        ├── forms_mms\
        │   ├── addAssets.php
        │   ├── checklist_template.php
        │   ├── checklist_lists.php
        │   ├── checklist_edit.php
        │   ├── routine_maintenance.php
        │   └── routine_maintenance_preview.php
        └── ... (other public views)
      </pre>

      <p class="small text-muted">Tip: keep docs like this in <code>/docs</code> or <code>/app/docs</code> so team members can view them in-browser.</p>
    </section>

    <section id="architecture" class="mb-4">
      <h2 class="section-title">Architecture Overview</h2>
      <p>The app uses a classical MVC layout with controllers serving views and models performing DB access via PDO.</p>

      <h6 class="mt-3">High-level flow</h6>
      <div class="flow mb-3">
Browser → index.php (router) → Controller → Model (PDO MSSQL) → Views (HTML/Bootstrap)
      </div>

      <h6>Database highlights</h6>
      <ul>
        <li><strong>checklist_template</strong> — templates with <code>work_order</code>, <code>maintenance_type</code>, <code>interval_days</code>.</li>
        <li><strong>checklist_tasks</strong> — per-template task rows (FK to template using tenant+checklist).</li>
        <li><strong>assets</strong> — tenant-scoped asset master.</li>
        <li><strong>routine_Work_Orders</strong> — generated work orders: include <code>work_order_ref</code>, <code>checklist_id</code>, next date, status.</li>
      </ul>
    </section>

    <section id="process" class="mb-4">
      <h2 class="section-title">Process Flows (text)</h2>

      <h6 class="mt-2">A. Routine Work Order Generation</h6>
      <div class="flow mb-3">
1) User chooses: Work Order template + Asset(s)
2) Controller validates CSRF + inputs
3) Model loads checklist_template by work_order
4) For each selected asset:
   • ensure asset exists & belongs to tenant
   • check duplicates (tenant + asset + checklist_id + status='scheduled')
   • if none -> insert routine_Work_Orders row (copy fields from checklist_template into work_order_ref)
5) Return inserted count -> Controller flashes success message
      </div>

      <h6 class="mt-2">B. Checklist Edit (header + tasks)</h6>
      <div class="flow">
1) Load header + tasks via LEFT JOIN (checklist_template + checklist_tasks)
2) Render edit form with task_id[] task_order[] task_text[]
3) On submit: Model
   • update header row
   • update existing tasks (by id)
   • insert new tasks (no id)
   • delete tasks not sent (cleanup using keepIds)
      </div>
    </section>

    <section id="readme" class="mb-4">
      <h2 class="section-title">README (short)</h2>
      <p class="mb-1"><strong>Purpose:</strong> Manage assets and maintenance routines; auto-create work orders from checklist templates.</p>
      <p class="mb-1"><strong>Run locally:</strong></p>
      <ol>
        <li>Place project in your webroot (e.g. <code>f:\xamp_server\htdocs\mes\</code>).</li>
        <li>Set DB credentials in <code>.env</code> and ensure <code>Database.php</code> reads them.</li>
        <li>Import DB schema (checklist tables, assets, routine_Work_Orders).</li>
        <li>Start Apache + PHP (XAMPP). Visit <code>/mes/signin</code>.</li>
      </ol>

      <h6 class="mt-3">Notes & Best Practices</h6>
      <ul>
        <li>Always protect form actions with CSRF tokens — controllers generate and validate tokens.</li>
        <li>Use tenant-scoped queries — always include <code>tenant_id</code> in WHERE clauses.</li>
        <li>Transactions are used where multiple row changes must be atomic (e.g. checklist update).</li>
        <li>Keep this doc in <code>/docs</code> so other developers can open it in-browser.</li>
      </ul>
    </section>

    <footer class="text-muted small mt-4">
      <div>If you want a PDF export, a printable PDF version, or an ERD diagram image (PNG/SVG), tell me and I’ll generate it.</div>
      <div class="mt-2">— MMS Documentation</div>
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
